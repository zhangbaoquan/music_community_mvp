# “亲亲心情笔记” (Music Community MVP) 产品设计与复盘文档

## 1. 项目背景与初衷
随着现代生活节奏的加快，人们越来越需要一个纯粹、私密的树洞来倾诉情绪。传统的纯文字日记缺乏情感的共鸣，而大型图文社交平台又过于喧嚣、充满了社交压力。
“亲亲心情笔记”的诞生初衷，是为了探索一种**“音乐 + 心情”**的新型双向表达模式。用户在记录此刻心情的同时，可以自由搭配一首能够代表当下的原创或喜爱的心境音乐。
作为一款 MVP (Minimum Viable Product，最小可行性产品)，本项目由独立开发者（单兵作战）发起。为了能够最快地将核心概念推向市场进行数据验证，并且为未来的 Native App (iOS/Android) 铺路，我们在一开始就选定了可以跨端复用代码的 Flutter Web 作为验证载体。

## 2. 核心设计理念
本产品的核心哲学可以概括为：**“听见情绪，写下声音”**。
*   **极简认知，降噪表达：** 界面主色调采用克制的黑（`#1A1A1A`）白灰体系，通过大面积留白，让用户的视觉焦点始终集中在文字与音乐播放器上，消除不必要的组件干扰。
*   **沉浸式背景伴随：** 建立全局持久化的音乐播放引擎。无论用户是在浏览信息流、查看个人主页，还是在撰写长篇文章，当前的心情音乐都会在全球任何页面无缝流转、持续相伴，不被打断。
*   **正向激励引擎：** 通过轻量级的游戏化设计（Gameification / Badge System），在没有巨大流量的冷启动初期，给早期内容创作者设定里程碑式的正向反馈，鼓励他们持续产出内容。

---

## 3. 已实现的核心功能板块

经过多轮迭代，MVP 已经跑通了作为一个内容社区的完整链路：

### 3.1 内容创作与流转 (Content Engine)
*   **心情电台 (Mood Station) - Feed流：** 支持瀑布流展示用户发布的心情日记/文章，直观呈现封面、标题、摘要及关联音乐。
*   **沉浸式富文本编辑器：** 深度集成了 `flutter_quill` 引擎，打破了简单的纯文本束缚，允许用户插入多图排版，并强制或自选绑定一首站内音乐。
*   **音乐金库 (Audio Lab)：** 允许认证用户上传自己的独立音乐/音频（MP3等），这些音乐将作为全站共享的心境 BGM 供其他人写日记时调用。

### 3.2 互动社交图谱 (Social Graph)
*   **星空回音 (Realtime Comments)：** 配合 Supabase Realtime 技术，实现了文章界面的实时跟帖互动体系。所有评论即发即现，带给用户如同面对面聊天的实时沉浸感。
*   **用户关系链：** 实现了核心的“关注 (Follow)”、“取消关注”以及双向的粉丝列表展示。
*   **轻互动矩阵：** 包含对文章、对评论的“点赞 (Like)”，以及文章的“收藏 (Collection)”分类夹功能。这三种轻度动作，构成了用户日常消耗碎片时间的主要路径。

### 3.3 个人数字绿洲 (Profile Dashboard)
*   **数据展板：** 提供实时的访问数据分析（包括谁看了我、我有多少粉丝、点赞总数等被动指标），并附带了头像上传、个性签名编辑的完整闭环。
*   **资产管理：** 用户可以清晰地管理自己发布的文章（支持编辑/删除）、上传的原创音乐，以及归档的历史收藏文章。
*   **生涯徽章 (Gamification Badges)：** 实现了成就系统墙。当发布文章数、获赞数达到特定阶段（如：10篇、50篇里程碑），系统自动在全球数据库触发事件，为用户颁发数字荣誉勋章并展示在主页。

### 3.4 社区自治与安全 (Admin & Safety)
*   **上帝视角工作台 (Admin Panel)：** 实现了基础的后台管制中心，管理员可以巡查新注册用户画像、监控敏感文章内容。
*   **风控封禁系统：** 提供一键违规处理（永久封禁 / 临时封停到期解封），并配套了友好的前端拦截提示。

---

## 4. MVP 阶段的功能亮点

1.  **全局无损音频流转：** 利用 GetX 状态管理构建的单例播放器控制器（`PlayerController`），完美解决了 Web 端 SPA (Single Page Application) 跳转导致音频重新加载中断的业界痛点。
2.  **桌面/移动端一套代码自适应 (Adaptive UI)：** 虽然是 Web 页面，但经过了专门的 `LayoutBuilder` 断点设计。PC 宽屏状态下采用主流的“左侧侧边栏导航 + 中部宽体沉浸区”的双列布局；而在 Mobile 窄屏环境自动响应折叠为底栏 (BottomNavigationBar) 设计，操作符合原生 App 直觉。
3.  **首屏极速加载优化：** 彻底抛弃了原生 Flutter Web 加载黑屏或白屏太久的痼疾。首屏植入 CSS DOM 骨架动画，在 Dart 引擎接管渲染管线的第一帧通过 JS 互操作释放转场，视觉无缝丝滑。

---

## 5. 当前存在的不足与瓶颈（复盘）

作为快速验证的 MVP，为了追求速度，我们在设计与工程上也做了一些妥协，这也是目前存在的短板：

1.  **原生 Web SEO（搜索引擎优化）缺失：**
    *   *问题：* Flutter Web 本质上是一个绘制在 Canvas 上的绘图引擎，它并不产生传统的 HTML DOM 结构树。这导致 Baidu、Google 等爬虫无法抓取站内的优秀文章内容。对于一个渴望自然流量的内容社区来说，这是一个致命伤。
2.  **富媒体资源的前端压缩缺失：**
    *   *问题：* 目前用户上传的高清封面图（可能高达好几兆）、高码率音频文件，都是纯裸数据直接打到后端的 S3 Bucket 中。不仅极大地消耗了云端存储成本，也导致终端网络较差的用户在加载图片流时出现明显的瀑布状卡顿。
3.  **无限滚动与大数据流的分页控制 (Pagination)：**
    *   *问题：* 目前的帖子拉取、评论拉取大多采用一次性拉取 Limit 或全量加载（例如评论区）。随着数据池的扩张，前端内存开销会显著暴涨，页面 FPS 初始化会面临性能瓶颈。
4.  **前端聚合计算导致的复杂逻辑堆叠：**
    *   *问题：* 为了统计“我总共获得了多少赞”，目前的代码需要在客户端或者循环请求多次。部分复杂聚合操作（如连表计算粉丝的心情指数）缺乏在后端编写 SQL View (视图) 或 RPC（存储过程）的支撑。例如我们之前修复的 Supabase `.count()` 类型隐患，就是因为强依赖客户端查询导致的风险。

---

## 6. 后续重构与优化方向 (Optimization)

针对上述痛点，如果项目验证取得良好的留存数据，下一步的优化排期如下：

1.  **资源管道化处理 (Pipeline)：**
    *   在 Flutter 客户端接入 `flutter_image_compress` (对于移动端) 和对应的 Web 压缩方案，严格把控所有上传图片的分辨率安全阈值和 WebP 格式转换，降低静态带宽 70% 损耗。
2.  **列表性能重构：**
    *   引入游标分页 (Cursor Pagination)。彻底舍弃原生的 `ListView.builder` 直接满载，改用带有上拉加载状态管理的机制。
3.  **后端数据视点下放 (Postgres RPC Functions)：**
    *   把计算类工作大额托付给后端的 PostgreSQL 引擎。我们将编写大量的 Supabase SQL 函数，前端只需要调用一个简单的 RPC (Remote Procedure Call)，直接拿取算好的结果报表。
4.  **Web 音视频策略兼容：**
    *   攻克 iOS Safari 等移动端浏览器严格的“严禁未经手势互动的自动播放 (Auto-Play Policy)”策略，优化播放预加载队列体验。

---

## 7. 未来拓展功能规划 (Future Roadmap)

在稳固了 MVP 的核心“写日记+听音乐+点赞留言”环形链路后，横向业务扩张的大饼如下：

1.  **1 v 1 灵魂私信 (Direct Messaging)：**
    *   利用现成已经跑通的 Supabase Realtime 技术，增加点对点的私聊窗格。从“靠内容认识你”走向“深度社交破冰”。
2.  **AI 情绪调音师 (AI Integration)：**
    *   接入大语言模型 (如 GPT-4 / 文心一言) API。未来当用户写完一段日记，系统可自动分析文字中的 Sentiment（情绪向度），自动“猜你喜欢”并推荐一首合适的曲库底层 BGM，无需用户手动再去浩瀚的乐库里搜索，达到真正的“心有灵犀”。
3.  **多端 Native App 上线：**
    *   这正是我们押注 Flutter 的终极目的。将现有的业务逻辑层原封不动（0重构），只需要适配部分 Native 插件池，即可将本产品打包生成 iOS 端上架 App Store 及 Android 商店包，配合极光推送等提供强大的 App 唤醒及留存率。
4.  **个人主页深度自定义模式 (Profile Customization)：**
    *   允许高价值核心用户上传自己的主页顶部背景图 (Banner)，定义日记专栏的颜色主题，进一步强化用户的个人空间归属感。
